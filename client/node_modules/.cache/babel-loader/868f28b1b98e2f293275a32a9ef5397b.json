{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/mumta/crewmates/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/mumta/crewmates/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/mumta/crewmates/client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/mumta/crewmates/client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport crossFetch from 'cross-fetch';\n\nvar PostgrestBuilder = /*#__PURE__*/function () {\n  function PostgrestBuilder(builder) {\n    _classCallCheck(this, PostgrestBuilder);\n\n    this.shouldThrowOnError = false;\n    this.method = builder.method;\n    this.url = builder.url;\n    this.headers = builder.headers;\n    this.schema = builder.schema;\n    this.body = builder.body;\n    this.shouldThrowOnError = builder.shouldThrowOnError;\n    this.signal = builder.signal;\n    this.allowEmpty = builder.allowEmpty;\n\n    if (builder.fetch) {\n      this.fetch = builder.fetch;\n    } else if (typeof fetch === 'undefined') {\n      this.fetch = crossFetch;\n    } else {\n      this.fetch = fetch;\n    }\n  }\n  /**\r\n   * If there's an error with the query, throwOnError will reject the promise by\r\n   * throwing the error instead of returning it as part of a successful response.\r\n   *\r\n   * {@link https://github.com/supabase/supabase-js/issues/92}\r\n   */\n\n\n  _createClass(PostgrestBuilder, [{\n    key: \"throwOnError\",\n    value: function throwOnError() {\n      this.shouldThrowOnError = true;\n      return this;\n    }\n  }, {\n    key: \"then\",\n    value: function then(onfulfilled, onrejected) {\n      var _this = this;\n\n      // https://postgrest.org/en/stable/api.html#switching-schemas\n      if (this.schema === undefined) {// skip\n      } else if (['GET', 'HEAD'].includes(this.method)) {\n        this.headers['Accept-Profile'] = this.schema;\n      } else {\n        this.headers['Content-Profile'] = this.schema;\n      }\n\n      if (this.method !== 'GET' && this.method !== 'HEAD') {\n        this.headers['Content-Type'] = 'application/json';\n      } // NOTE: Invoke w/o `this` to avoid illegal invocation error.\n      // https://github.com/supabase/postgrest-js/pull/247\n\n\n      var _fetch = this.fetch;\n\n      var res = _fetch(this.url.toString(), {\n        method: this.method,\n        headers: this.headers,\n        body: JSON.stringify(this.body),\n        signal: this.signal\n      }).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(res) {\n          var _a, _b, _c, error, data, count, status, statusText, body, countHeader, contentRange, _body, postgrestResponse;\n\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  error = null;\n                  data = null;\n                  count = null;\n                  status = res.status;\n                  statusText = res.statusText;\n\n                  if (!res.ok) {\n                    _context.next = 16;\n                    break;\n                  }\n\n                  if (!(_this.method !== 'HEAD')) {\n                    _context.next = 11;\n                    break;\n                  }\n\n                  _context.next = 9;\n                  return res.text();\n\n                case 9:\n                  body = _context.sent;\n\n                  if (body === '') {// Prefer: return=minimal\n                  } else if (_this.headers['Accept'] === 'text/csv') {\n                    data = body;\n                  } else if (_this.headers['Accept'] && _this.headers['Accept'].includes('application/vnd.pgrst.plan+text')) {\n                    data = body;\n                  } else {\n                    data = JSON.parse(body);\n                  }\n\n                case 11:\n                  countHeader = (_a = _this.headers['Prefer']) === null || _a === void 0 ? void 0 : _a.match(/count=(exact|planned|estimated)/);\n                  contentRange = (_b = res.headers.get('content-range')) === null || _b === void 0 ? void 0 : _b.split('/');\n\n                  if (countHeader && contentRange && contentRange.length > 1) {\n                    count = parseInt(contentRange[1]);\n                  }\n\n                  _context.next = 23;\n                  break;\n\n                case 16:\n                  _context.next = 18;\n                  return res.text();\n\n                case 18:\n                  _body = _context.sent;\n\n                  try {\n                    error = JSON.parse(_body); // Workaround for https://github.com/supabase/postgrest-js/issues/295\n\n                    if (Array.isArray(error) && res.status === 404) {\n                      data = [];\n                      error = null;\n                      status = 200;\n                      statusText = 'OK';\n                    }\n                  } catch (_d) {\n                    // Workaround for https://github.com/supabase/postgrest-js/issues/295\n                    if (res.status === 404 && _body === '') {\n                      status = 204;\n                      statusText = 'No Content';\n                    } else {\n                      error = {\n                        message: _body\n                      };\n                    }\n                  }\n\n                  if (error && _this.allowEmpty && ((_c = error === null || error === void 0 ? void 0 : error.details) === null || _c === void 0 ? void 0 : _c.includes('Results contain 0 rows'))) {\n                    error = null;\n                    status = 200;\n                    statusText = 'OK';\n                  }\n\n                  if (!(error && _this.shouldThrowOnError)) {\n                    _context.next = 23;\n                    break;\n                  }\n\n                  throw error;\n\n                case 23:\n                  postgrestResponse = {\n                    error: error,\n                    data: data,\n                    count: count,\n                    status: status,\n                    statusText: statusText\n                  };\n                  return _context.abrupt(\"return\", postgrestResponse);\n\n                case 25:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n\n      if (!this.shouldThrowOnError) {\n        res = res.catch(function (fetchError) {\n          return {\n            error: {\n              message: \"FetchError: \".concat(fetchError.message),\n              details: '',\n              hint: '',\n              code: fetchError.code || ''\n            },\n            data: null,\n            count: null,\n            status: 0,\n            statusText: ''\n          };\n        });\n      }\n\n      return res.then(onfulfilled, onrejected);\n    }\n  }]);\n\n  return PostgrestBuilder;\n}();\n\nexport { PostgrestBuilder as default };","map":{"version":3,"mappings":"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","names":["crossFetch","PostgrestBuilder","builder","method","url","headers","schema","body","shouldThrowOnError","signal","allowEmpty","fetch","onfulfilled","onrejected","undefined","includes","_fetch","res","toString","JSON","stringify","then","error","data","count","status","statusText","ok","text","parse","countHeader","_a","match","contentRange","get","_b","split","length","parseInt","Array","isArray","message","details","_c","postgrestResponse","catch","fetchError","hint","code"],"sources":["C:\\Users\\mumta\\crewmates\\client\\node_modules\\@supabase\\postgrest-js\\src\\PostgrestBuilder.ts"],"sourcesContent":["import crossFetch from 'cross-fetch'\r\n\r\nimport type { Fetch, PostgrestSingleResponse } from './types'\r\n\r\nexport default abstract class PostgrestBuilder<Result>\r\n  implements PromiseLike<PostgrestSingleResponse<Result>>\r\n{\r\n  protected method: 'GET' | 'HEAD' | 'POST' | 'PATCH' | 'DELETE'\r\n  protected url: URL\r\n  protected headers: Record<string, string>\r\n  protected schema?: string\r\n  protected body?: unknown\r\n  protected shouldThrowOnError = false\r\n  protected signal?: AbortSignal\r\n  protected fetch: Fetch\r\n  protected allowEmpty: boolean\r\n\r\n  constructor(builder: PostgrestBuilder<Result>) {\r\n    this.method = builder.method\r\n    this.url = builder.url\r\n    this.headers = builder.headers\r\n    this.schema = builder.schema\r\n    this.body = builder.body\r\n    this.shouldThrowOnError = builder.shouldThrowOnError\r\n    this.signal = builder.signal\r\n    this.allowEmpty = builder.allowEmpty\r\n\r\n    if (builder.fetch) {\r\n      this.fetch = builder.fetch\r\n    } else if (typeof fetch === 'undefined') {\r\n      this.fetch = crossFetch\r\n    } else {\r\n      this.fetch = fetch\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If there's an error with the query, throwOnError will reject the promise by\r\n   * throwing the error instead of returning it as part of a successful response.\r\n   *\r\n   * {@link https://github.com/supabase/supabase-js/issues/92}\r\n   */\r\n  throwOnError(): this {\r\n    this.shouldThrowOnError = true\r\n    return this\r\n  }\r\n\r\n  then<TResult1 = PostgrestSingleResponse<Result>, TResult2 = never>(\r\n    onfulfilled?:\r\n      | ((value: PostgrestSingleResponse<Result>) => TResult1 | PromiseLike<TResult1>)\r\n      | undefined\r\n      | null,\r\n    onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null\r\n  ): PromiseLike<TResult1 | TResult2> {\r\n    // https://postgrest.org/en/stable/api.html#switching-schemas\r\n    if (this.schema === undefined) {\r\n      // skip\r\n    } else if (['GET', 'HEAD'].includes(this.method)) {\r\n      this.headers['Accept-Profile'] = this.schema\r\n    } else {\r\n      this.headers['Content-Profile'] = this.schema\r\n    }\r\n    if (this.method !== 'GET' && this.method !== 'HEAD') {\r\n      this.headers['Content-Type'] = 'application/json'\r\n    }\r\n\r\n    // NOTE: Invoke w/o `this` to avoid illegal invocation error.\r\n    // https://github.com/supabase/postgrest-js/pull/247\r\n    const _fetch = this.fetch\r\n    let res = _fetch(this.url.toString(), {\r\n      method: this.method,\r\n      headers: this.headers,\r\n      body: JSON.stringify(this.body),\r\n      signal: this.signal,\r\n    }).then(async (res) => {\r\n      let error = null\r\n      let data = null\r\n      let count: number | null = null\r\n      let status = res.status\r\n      let statusText = res.statusText\r\n\r\n      if (res.ok) {\r\n        if (this.method !== 'HEAD') {\r\n          const body = await res.text()\r\n          if (body === '') {\r\n            // Prefer: return=minimal\r\n          } else if (this.headers['Accept'] === 'text/csv') {\r\n            data = body\r\n          } else if (\r\n            this.headers['Accept'] &&\r\n            this.headers['Accept'].includes('application/vnd.pgrst.plan+text')\r\n          ) {\r\n            data = body\r\n          } else {\r\n            data = JSON.parse(body)\r\n          }\r\n        }\r\n\r\n        const countHeader = this.headers['Prefer']?.match(/count=(exact|planned|estimated)/)\r\n        const contentRange = res.headers.get('content-range')?.split('/')\r\n        if (countHeader && contentRange && contentRange.length > 1) {\r\n          count = parseInt(contentRange[1])\r\n        }\r\n      } else {\r\n        const body = await res.text()\r\n\r\n        try {\r\n          error = JSON.parse(body)\r\n\r\n          // Workaround for https://github.com/supabase/postgrest-js/issues/295\r\n          if (Array.isArray(error) && res.status === 404) {\r\n            data = []\r\n            error = null\r\n            status = 200\r\n            statusText = 'OK'\r\n          }\r\n        } catch {\r\n          // Workaround for https://github.com/supabase/postgrest-js/issues/295\r\n          if (res.status === 404 && body === '') {\r\n            status = 204\r\n            statusText = 'No Content'\r\n          } else {\r\n            error = {\r\n              message: body,\r\n            }\r\n          }\r\n        }\r\n\r\n        if (error && this.allowEmpty && error?.details?.includes('Results contain 0 rows')) {\r\n          error = null\r\n          status = 200\r\n          statusText = 'OK'\r\n        }\r\n\r\n        if (error && this.shouldThrowOnError) {\r\n          throw error\r\n        }\r\n      }\r\n\r\n      const postgrestResponse = {\r\n        error,\r\n        data,\r\n        count,\r\n        status,\r\n        statusText,\r\n      }\r\n\r\n      return postgrestResponse\r\n    })\r\n    if (!this.shouldThrowOnError) {\r\n      res = res.catch((fetchError) => ({\r\n        error: {\r\n          message: `FetchError: ${fetchError.message}`,\r\n          details: '',\r\n          hint: '',\r\n          code: fetchError.code || '',\r\n        },\r\n        data: null,\r\n        count: null,\r\n        status: 0,\r\n        statusText: '',\r\n      }))\r\n    }\r\n\r\n    return res.then(onfulfilled, onrejected)\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}